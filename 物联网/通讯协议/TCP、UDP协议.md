 TCP/UDP协议
========

@(物联网)


[toc]


>-如果你注定要成为厉害的人, 那问题的答案就深藏在你的血脉里
## TCP/UDP

TCP (Transmission Control Protocol)和UDP(User Datagram Protocol)协议属于传输层协议。
**其中TCP提供IP环境下的数据可靠传输，它提供的服务包括数据流传送、可靠性、有效流控、全双工操作和多路复用。通过面向连接、端到端和可靠的数据包发送。**


通俗说，它是事先为所发送的数据开辟出连接好的通道，然后再进行数据发送；而UDP则不为IP提供可靠性、流控或差错恢复功能。**一般来说TCP对应的是可靠性要求高的应用，而UDP对应的则是可靠性要求低、传输经济的应用。**

TCP支持的应用协议主要有：Telnet、FTP、SMTP等；UDP支持的应用层协议主要有：NFS（网络文件系统）、SNMP（简单网络管理协议）、DNS（主域名称系统）、TFTP（通用文件传输协议）等。


## TCP

TCP是面向连接的通信协议，通过**三次握手**建立连接，通讯完成时要拆除连接，由于TCP是面向连接的**所以只能用于端到端的通讯**。

TCP提供的是一种可靠的数据流服务，采用“**带重传的肯定确认**”技术来实现传输的可靠性。TCP还采用一种称为“**滑动窗口**”的方式进行流量控制，所谓窗口实际表示接收能力，用以限制发送方的发送速度。


如果IP数据包中有已经封好的TCP数据包，那么IP将把它们向‘上’传送到TCP层。

TCP将包排序并进行错误检查，同时实现虚电路间的连接。TCP数据包中包括序号和确认，所以未按照顺序收到的包可以被排序，而损坏的包可以被重传。

TCP将它的信息送到更高层的应用程序，例如Telnet的服务程序和客户程序。应用程序轮流将信息送回TCP层，TCP层便将它们向下传送到IP层，设备驱动程序和物理介质，最后到接收方。
面向连接的服务（例如Telnet、FTP、rlogin、X Windows和SMTP）需要高度的可靠性，所以它们使用了TCP。DNS在某些情况下使用TCP（发送和接收域名数据库），但使用UDP传送有关单个主机的信息。


> [通俗大白话来理解TCP协议的三次握手和四次分手](https://github.com/jawil/blog/issues/14)


## UDP：

UDP是**面向无连接的通讯协议**，UDP数据包括目的端口号和源端口号信息，由于通讯不需要连接，所以可以实现广播发送。

UDP通讯时不需要接收方确认，属于不可靠的传输，可能会出现丢包现象，实际应用中要求程序员编程验证。

UDP与TCP位于同一层，但它不管数据包的顺序、错误或重发。

因此，UDP不被应用于那些使用虚电路的面向连接的服务，UDP主要用于那些面向查询---应答的服务，例如NFS。相对于FTP或Telnet，这些服务需要交换的信息量较小。使用UDP的服务包括NTP（网络时间协议）和DNS（DNS也使用TCP）。

欺骗UDP包比欺骗TCP包更容易，因为UDP没有建立初始化连接（也可以称为握手）（因为在两个系统间没有虚电路），也就是说，与UDP相关的服务面临着更大的危险。

## 数据格式：

**数据帧**：帧头+IP数据包+帧尾 （帧头包括源和目标主机MAC初步地址及类型，帧尾是校验字）
**IP数据包**：IP头部+TCP数据信息（IP头包括源和目标主机IP地址、类型、生存期等）
**TCP数据信息**：TCP头部+实际数据 (TCP头包括源和目标主机端口号、顺序号、确认号、校验字等）

UDP（User Data Protocol，用户数据报协议）是与TCP相对应的协议。它是面向非连接的协议，它不与对方建立连接，而是直接就把数据包发送过去！
